<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.8.7/pixi.min.js"></script>
<script src="scrollbox.js"></script>
<script>
function fillMenu(container)
{
    var shuffledNest = _.shuffle(nests);
    _.each(shuffledNest, function (nest, i)
    {

        let nestContainer = new PIXI.Container();
        let nestFrame = new PIXI.Sprite();
        nestFrame.width = 200;
        nestFrame.height = 110;

        nestContainer.addChild(nestFrame);

        var nestToken = new PIXI.Sprite(nest.badge);
        nestToken.name = nest.name;
        nestToken.isNest = true;
        nestToken.anchor.set(0.5, 0.5);
        nestToken.scale.set(token_scale);
        nestToken.interactive = true;
        nestToken.buttonMode = true;
        nestToken
            .on('pointerdown', onDragStart)
            .on('pointerup', onDragEnd)
            .on('pointerupoutside', onDragEnd)
            .on('pointermove', onDragMove);

        nestContainer.addChild(nestToken);

        nestToken.position.set(0, 0);

        nests[i].instance = nestToken;

        let textStyle = new PIXI.TextStyle({
            wordWrap: true,
            wordWrapWidth: 200,
            fontFamily: "triogrotesk-normal-v102",
            fontSize: 22
        });
        let text = new PIXI.Text(nest.text, textStyle);
        nestContainer.addChild(text);

        text.position.set(40, -text.height / 2);

        let y = i * 100;
        nestContainer.position.set(20 + nestToken.width / 2, y);
        container.addChild(nestContainer);
        nestToken.ix = nestToken.x;
        nestToken.iy = nestToken.y;

    });
}

function buildMenu()
{
    var menuBar = new PIXI.Container();
    app.stage.addChild(menuBar);

    menuBar.position.set(0, 0);

    menuBarBg = new PIXI.Graphics();
    menuBar.addChild(menuBarBg);

    menuBarBg.beginFill(0xF6F6F6);
    menuBarBg.drawRoundedRect(0, 0, 300, app.screen.height);
    menuBarBg.drawRect(0, 0, 50, app.screen.height);
    menuBarBg.endFill();

    menuScrollbox = new PIXI.extras.Scrollbox({
        overflowX: "none",
        overflowY: "hidden",
        underflow: "top-left",
        boxWidth: 300,
        boxHeight: app.screen.height,
        stopPropagation: false
    });
    menuScrollbox.position.set(0, 0);
    menuBar.addChild(menuScrollbox);

    let nests = new PIXI.Container();
    nests.position.set(0, 0);

    fillMenu(nests);
    menuScrollbox.content.addChild(nests);
    menuScrollbox.update();
}

var app

window.onload = () => {
    app = new PIXI.Application()
    document.body.appendChild(app.view)
    buildMenu()
}
</script>
</head>